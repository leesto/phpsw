---
- hosts: app
  become: true
  roles:
    - {role: server,   tags: [server]}
    - {role: hostname, tags: [hostname]}
    - {role: user,     tags: [user]}
    - {role: nginx,    tags: [nginx]}
    - {role: php,      tags: [php]}
    - {role: composer, tags: [composer]}
    - {role: haproxy,  tags: [haproxy]}
    - {role: node,     tags: [node]}
    - {role: redis,    tags: [redis]}
    - {role: thumbor,  tags: [thumbor]}
    - {role: varnish,  tags: [varnish]}
    - {role: xdebug,   tags: [xdebug]}
    - {role: aws,      when: "app_hostname == 'phpsw.uk'", tags: [aws]}
    - {role: vagrant,  when: "app_hostname == 'phpsw.vm'", tags: [vagrant]}
    - {role: app,      tags: [app]}
    - {role: blog,     tags: [blog]}
  vars_files:
    - secrets.yml
    - variables.yml
